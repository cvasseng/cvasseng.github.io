<!DOCTYPE HTML>
<html>
<head>
  <meta charset="utf-8">
  
  <title>Help, I accidentally built a compiler! | tinkerer.xyz</title>
  <meta name="author" content="chris">
  
  <meta name="description" content="When I was 13 years old, I took an interest in programming. One of the primary driving forces was that I really, really wanted to build a game. Specif">
  
  
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

  <meta property="og:title" content="Help, I accidentally built a compiler!"/>
  <meta property="og:site_name" content="tinkerer.xyz"/>

  
    <meta property="og:image" content="undefined"/>
  

  <link href="/favicon.ico" rel="shortcut icon">
  <link rel="alternate" href="/atom.xml" title="tinkerer.xyz" type="application/atom+xml">
  <link rel="stylesheet" href="/css/font-awesome.min.css" type="text/css">
  <link rel="stylesheet" href="/css/style.css" media="screen" type="text/css">
  <!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
  <script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>
<script src="/js/jquery.imagesloaded.min.js"></script>
<script src="/js/gallery.js"></script>
  
<script type="text/javascript">
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-55610135-1', 'auto');
  ga('send', 'pageview');

</script>


</head>


<body>
  <header id="header" class="inner"><div id="nav-top">
  <div class="alignleft main-title">
    <h1>tinkerer.xyz</h1>
    <h2></h2>
  </div>
  <nav id="main-nav" class="alignright">
    <ul>
      
        <li><a href="/">Home</a></li>
      
        <li><a href="/archives">Archives</a></li>
      
    </ul>
    <div class="clearfix"></div>
  </nav>
  <div class="clearfix"></div>
</div></header>
  <div id="content" class="inner">
    <div id="main-col" class="alignleft"><div id="wrapper"><article class="post">
  
  <div class="post-content">
    <header>
      
      
        <div class="icon"></div>
        <time datetime="2016-02-18T20:58:45.000Z"><a href="/2016/02/18/help-accidental-compiler/">Feb 18 2016</a></time>
      
      
  
    <h1 class="title">Help, I accidentally built a compiler!</h1>
  

      <div style="text-align:right;font-style:italic;">by chris</div>
      
    </header>
    <div class="entry">
      
        
          
        
        <p><strong>When I was 13 years old, I took an interest in programming. One of the primary driving forces was that I really, really wanted to build a game. Specifically, I wanted to build a role playing game. 17 years later, my quest is still not completed.</strong></p>
<h2 id="The-Quest"><a href="#The-Quest" class="headerlink" title="The Quest"></a>The Quest</h2><p>I’ve lost count on how many times I’ve started building my Super Awesome Role Playing Game. Dozens for sure. Usually I’ve made it to some half-assed state where I have a few really basic things working before real-life’s come calling on me. Sometimes I’ve made it further, to the point where something’s been playable, and other times I’ve strayed so far off the path in my quest that I’ve ended up doing something completely different, yet tangibly related (like the at least two times I ended up building UI libraries instead - the latest which is available <a href="http://tinkerer.xyz/ThursUI">here</a>). </p>
<p>My compiler is very much of the “how did I even end up here”-type. </p>
<h2 id="It-Begins-Again"><a href="#It-Begins-Again" class="headerlink" title="It Begins (Again)"></a>It Begins (Again)</h2><p>My latest quest started sometime around August 2014. I was able to get a few hours a week to do pet projects when my work schedule decreased from 16-ish hour days to a more reasonable 10-ish. And what better way to use those extra hours after coding than for more coding? I resurrected my seemingly unattainable quest from the depths of my journal, and began thinking the same thoughts I had so many times before. 2d? 3d? C++? Node/JS? Some existing engine? After a week or two I settled on good old C++, mostly because at the time I was really, really tired of the web-stack which had been my day job for some time. And off I went; starting to define the architecture for <em>The Engine</em>. Again. </p>
<p>All was well. Until it became time to choose a scripting language. Lua is usually my goto-solution, as it’s lean, fast, and fairly easy to bind to if the game/engine is written with it in mind from the beginning. This time though, things were different. A friend of mine had been talking a lot about programming language theory, and his own quest to build his own programming language. The discussions where quite interesting, and piqued my own interest in the topic. I started thinking that maybe a custom solution would be superior. A language designed to build RPG’s and nothing else. A language where RPG-related concepts were language types and constructs. I caved to my inner cravings of reinventing the wheel, and set out to define a syntax for <em>The Language</em>. All bets where off at this point.</p>
<p>I started reading whatever I could on implementing virtual machines. I didn’t really find any good material for non-lisp/scheme languages, so I was mostly fumbling around in the dark. I ended up stealing a few instructions from x86 assembly, and created a weirdly encoded bytestream and a bunch of case statements. After not too long, I had a simple thing running where I could perform basic math on some pre-determined registers. I was completely hooked. The code was so simple, but it had so much potential. That’s when I decided - “people will call me crazy, but I’m gonna do this thing”.</p>
<p>I wrote the lexer and parser by hand, and created a simple abstract syntax tree to do code generation. The code was ugly as hell, but was eventually able to compile my language to my own custom bytecode, running in my own custom vm. I felt pretty bad ass.</p>
<p><em>First version of the syntax: defining a Hitpoint character attribute</em></p>
<pre><code>attribute Hitpoints
    meta
        title &quot;Hitpoints&quot;
    end
    on change
      if Hitpoints &lt; 0 
          ; The character is dead!
      end
    end
end
</code></pre><p>Before I knew it, I had implemented character attributes, AI, items, skills, buffs/de-buffs, and all sorts of things. Finally it was time to pull it all together and create my game! </p>
<h2 id="Help-I-need-a-UI"><a href="#Help-I-need-a-UI" class="headerlink" title="Help, I need a UI"></a>Help, I need a UI</h2><p>After I had my client integrated and up and running (the vm/engine was written as a headless server at that point), I realized I had 99 problems, and UI was one of them. I searched far and wide for days, and just couldn’t find anything that looked good enough. No disrespect to those of you out there maintaining things like CEGUI - my requirements were somewhat strict. For one, I really wanted something vector based. I’m not an artist, so creating skins is a pain when having to deal with texture atlases - I wanted CSS-esque styling, and I wanted crisp rendering without artifacts when running at high resolutions. A lot of the ones I tried didn’t compile within a reasonable amount of time either, which excluded them immediately (as in - it took me longer than two hours to gather up all the dependencies and get the library to compile).</p>
<p>I changed my searches to find hardware accelerated vector rasterizers instead. It didn’t take long before I stumbled across <a href="https://github.com/memononen/nanovg" target="_blank" rel="external">nanovg</a>, which looked absolutely perfect. The demo was exactly what I was looking for. Unfortunately, I couldn’t find a UI library built on top of it, so over the next couple of weeks I created <a href="http://tinkerer.xyz/ThursUI">a crude one myself</a>. </p>
<h2 id="Help-everything-I-did-was-wrong"><a href="#Help-everything-I-did-was-wrong" class="headerlink" title="Help, everything I did was wrong!"></a>Help, everything I did was wrong!</h2><p>In January 2015, the situation at work changed, and I was unable to continue grooming my pet project. Back into the journal it went. Then three months later, I was once again in a position to devote a couple of hours here and there to it. But of course - in typical fashion - I made the decision to abandon everything and start from scratch - this time building the compiler/vm as a separate library, meant to be used similarly to Lua where it’s integrated into other games/engines.<br>This might seem a bit drastic, but I had learned quite a lot during those 5 months of being away from the code, and I knew that if I started fresh, I’d end up with something a whole lot better. </p>
<p>I’ve now been working on and off for 7 months on the new version, and it’s closing in on the point where it’s mature enough to be used. The concept is pretty much the same as my “test run”, but the syntax is now more C-ish than Pascal-ish. It also solves certain domain problems in a better, more general way. As an example - instead of having primitives for buffs and debuffs, now there’s just a generic “timer” primitive that has optional modifiers, and that can be applied to an actor in the game. It’s also much, much faster than the first version, and have several things the first version lacked (like variables and proper functions, localization support, a debugger, and more). </p>
<p><em>The current version of the language:</em></p>
<pre><code>attribute HitPoints : InitialValue(100), Max(MaxHealth) {
  meta {
    localized title &quot;Hit Points&quot;;
    localized description &quot;Character Health&quot;;
  }

  on change {
    print(&quot;Health changed, and is now&quot;, HitPoints);
    if HitPoints &lt;= 0 {
      actor-&gt;kill();
    }
  }
}
</code></pre><h2 id="Conclusion"><a href="#Conclusion" class="headerlink" title="Conclusion"></a>Conclusion</h2><p>For some, the destination is the most important part. For others - like me - the journey is where it’s at. Every time I’ve started this project I’ve gotten something out of it. This time, I got a very deep understanding of compilers, and virtual machines - two areas that were pretty much magic to me prior to starting. I also got a decent <a href="http://tinkerer.xyz/ThursUI">prototyping UI library</a> out of it, and a working domain-specific scripting language </p>
<p>The first public preview version of the language will be released soon under a BSD-style license.</p>

      
    </div>
    <footer>
      
  
  <div class="categories">
    <a href="/categories/programming/">programming</a>, <a href="/categories/programming/gamedev/">gamedev</a>
  </div>

      
      
        <div class="alignright share-box">
  
    
      <a class="share-link share-google" href="https://plus.google.com/share?url=http://tinkerer.xyz/2016/02/18/help-accidental-compiler/&title=《Help, I accidentally built a compiler!》" title="google"></a>
    
  
  <a href="//www.reddit.com/submit" onclick="window.location = '//www.reddit.com/submit?url=http://tinkerer.xyz/2016/02/18/help-accidental-compiler/&title=Help, I accidentally built a compiler!'; return false"> <img src="//www.redditstatic.com/spreddit5.gif" alt="submit to reddit" border="0" /> </a>
</div>

        

      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>


<section id="comment">
  <h1 class="title">Kommentare</h1>

  
    <div id="disqus_thread"></div>
    <script type="text/javascript">
        /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
        var disqus_shortname = 'tinkererxyz'; // required: replace example with your forum shortname

        /* * * DON'T EDIT BELOW THIS LINE * * */
        (function() {
            var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
            dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
    </script>
    <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
    <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
  
</section>



</div></div>
    <aside id="sidebar" class="alignright">
  <div class="search">
  
    <form action="//google.com/search" method="get" accept-charset="utf-8">
      <input type="search" name="q" results="0" placeholder="Suche">
      <input type="hidden" name="q" value="site:tinkerer.xyz">
    </form>
  
</div>

  
<div class="widget tag">
  <h3 class="title">Neueste Artikel</h3>
  <ul class="entry">
    
      <li>
        <a href="/2016/03/06/why-no-loops-in-js/">Why you shouldn&#39;t use for-loops in JavaScript, and how to avoid them</a>
      </li>
    
      <li>
        <a href="/2016/02/18/adding-midi-to-monotribe/">Adding MIDI to a monotribe</a>
      </li>
    
      <li>
        <a href="/2016/02/18/hello-world/">Hello World</a>
      </li>
    
      <li>
        <a href="/2016/02/18/7_seg_arduino/">7 segment LEDs with Arduino and shift registers</a>
      </li>
    
      <li>
        <a href="/2016/02/18/attiny_and_arduino/">ATTiny25 and Arduino</a>
      </li>
    
  </ul>
</div>


  
<div class="widget tag">
  <h3 class="title">Kategorien</h3>
  <ul class="entry">
  
    <li><a href="/categories/electronics/arduino/">arduino</a><small>2</small></li>
  
    <li><a href="/categories/electronics/">electronics</a><small>3</small></li>
  
    <li><a href="/categories/programming/gamedev/">gamedev</a><small>1</small></li>
  
    <li><a href="/categories/programming/howto/">howto</a><small>1</small></li>
  
    <li><a href="/categories/programming/javascript/">javascript</a><small>1</small></li>
  
    <li><a href="/categories/programming/">programming</a><small>3</small></li>
  
    <li><a href="/categories/electronics/arduino/projects/">projects</a><small>0</small></li>
  
    <li><a href="/categories/synthesizers/">synthesizers</a><small>1</small></li>
  
  </ul>
</div>


  
<div class="widget tag">
  <h3 class="title">Tags</h3>
  <div class="entry">
    
      <span><a href="/tags/7-Segment-Display/">7 Segment Display<small>1</small></a></span>
    
      <span><a href="/tags/74HC595/">74HC595<small>1</small></a></span>
    
      <span><a href="/tags/CV/">CV<small>1</small></a></span>
    
      <span><a href="/tags/MCP4922/">MCP4922<small>0</small></a></span>
    
      <span><a href="/tags/MIDI/">MIDI<small>2</small></a></span>
    
      <span><a href="/tags/PCB/">PCB<small>2</small></a></span>
    
      <span><a href="/tags/Shift-Register/">Shift Register<small>1</small></a></span>
    
      <span><a href="/tags/attiny/">attiny<small>1</small></a></span>
    
      <span><a href="/tags/synthesizer-history/">synthesizer history<small>1</small></a></span>
    
  </div>
</div>

</aside>
    <div class="clearfix"></div>
  </div>
  <footer id="footer" class="inner"><div id="foot-nav">
  <ul class="social">
    
      <li><a class="github" href="https://github.com/cvasseng" title="github">github</a></li>
    
      <li><a class="rss" href="/atom.xml" title="rss">rss</a></li>
    
  </ul>
</div>
<div>
  
    &copy; 2016 chris
  
</div>
<div class="clearfix"></div></footer>
  
  <script type="text/javascript">
    var disqus_shortname = 'tinkererxyz';

    (function(){
      var dsq = document.createElement('script');
      dsq.type = 'text/javascript';
      dsq.async = true;
      dsq.src = '//' + disqus_shortname + '.disqus.com/count.js';
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
  </script>



<link rel="stylesheet" href="/fancybox/jquery.fancybox.css" media="screen" type="text/css">
<script src="/fancybox/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
(function($){
  $('.fancybox').fancybox();
})(jQuery);
</script>


<script type="text/javascript">
  function navbar() {
    var top = $('#nav-top').innerHeight();
    $('#header').css('min-height', top);
  }
  navbar();
  $(window).resize(navbar);
</script>
<div id="totop" class="footer-btn">
  <a title="Zurück Nach Oben"><img src="/img/scrollup.png"/></a>
</div>

<script type="text/javascript">
  $(function(){ 
	// When to show the scroll link
	// higher number = scroll link appears further down the page   
	var upperLimit = 800;
	
	// Our scroll link element
	var scrollElem = $('#totop');
   
	// Scroll to top speed
	var scrollSpeed = 500;
   
	// Show and hide the scroll to top link based on scroll position   
	scrollElem.hide();
	$(window).scroll(function () {            
		var scrollTop = $(document).scrollTop();       
		if ( scrollTop > upperLimit ) {
		  $(scrollElem).stop().fadeTo(300, 1); // fade back in
		  $(scrollElem).animate({bottom: "50px"}, { queue: false, duration: 10 });
		} else {
		  $(scrollElem).stop().fadeTo(300, 0); // fade out
	      $(scrollElem).animate({bottom: "-200px"}, { queue: false, duration: 10 });
			
		}
	});

	// Scroll to top animation on click
	$(scrollElem).click(function(){
	  $('html, body').animate({scrollTop:0}, scrollSpeed);
	  $(scrollElem).animate({bottom: "-200px"}, { queue: false, duration: 10 });
	  return false;
	});
  });
</script>

</body>
</html>